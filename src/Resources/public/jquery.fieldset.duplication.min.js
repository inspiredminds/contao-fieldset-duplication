!function(t){"use strict";t.fn.fieldsetDuplication=function(e){var n=t.extend({},{prepend:!1,buttonAdd:"+",buttonRemove:"&times;"},e);return t(this).each(function(e,i){var a=t(this),o=null,d=null,u=a.attr("class").split(/\s+/);t.each(u,function(t,e){if(e.match(/duplicate-fieldset-/))return d="."+e,!1});var r=function(){(o=t(d)).each(function(e,n){var i=t(this);i.removeClass("last"),i.removeClass("first"),0==e&&i.addClass("first"),e==o.length-1&&i.addClass("last"),s(i),i.hasClass("duplicate")?i.find(".duplication-buttons button.duplication-button--remove").show():i.find(".duplication-buttons button.duplication-button--remove").hide()})},l=function(e){e.find(".duplication-buttons button.duplication-button--add").off("click").on("click",function(e){return e.preventDefault(),function(e){if(!(o.length>=50)){var n=e.clone();0,n.find("input[name], select[name], textarea[name]").each(function(){var e=t(this);e.removeClass("error");var n=o.length+1,i=e.attr("id");if(void 0!==i){(u=i.indexOf("_duplicate_"))>=0&&(i=i.substr(0,u));var a=i+"_duplicate_"+n;e.closest(".widget").find('label[for="'+e.attr("id")+'"]').each(function(){var e=t(this);e.attr("for",a),void 0!==e.attr("id")&&e.attr("id",e.attr("id")+"_duplicate_"+n)}),e.attr("id",a)}var d=e.attr("name");if(void 0!==d){var u;(u=d.indexOf("_duplicate_"))>=0&&(d=d.substr(0,u));var r=d+"_duplicate_"+n;e.attr("name",r)}var l=e.attr("value");e.val()&&void 0!==l&&!1!==l&&e.val()!==l&&e.val(""),e.not("[checked]").prop("checked",!1)}),n.find("label").removeClass("error"),n.find("p.error").remove(),n.find(".widget").removeClass("error"),n.addClass("duplicate"),l(n),e.after(n),r(),t(document).trigger("fieldset-cloned",[n])}}(t(this).closest("fieldset")),!1}),e.hasClass("duplicate")&&e.find(".duplication-buttons button.duplication-button--remove").off("click").on("click",function(e){var n;return e.preventDefault(),n=t(this).closest("fieldset"),o.length>1&&n.hasClass("duplicate")&&(n.remove(),r()),!1})},s=function(e){e.find(".duplication-buttons").remove();var i=t('<div class="duplication-buttons"></div>'),a=t('<button type="button" class="duplication-button duplication-button--add">'+n.buttonAdd+"</button>");i.append(a);var o=t('<button type="button" class="duplication-button duplication-button--remove">'+n.buttonRemove+"</button>");i.append(o),n.prepend?e.prepend(i):e.append(i),l(e)};r()}),this}}(jQuery);