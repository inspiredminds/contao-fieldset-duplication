!function(t){"use strict";t.fn.fieldsetDuplication=function(e){var n=t.extend({},{prepend:!1,buttonAdd:"+",buttonRemove:"&times;",widgetSelector:".widget"},e);return t(this).each((function(e,i){var a=t(this),o=null,d=null,l=null,u=0,c=a.attr("class").split(/\s+/);t.each(c,(function(t,e){if(e.match(/duplicate-fieldset-/))return d="."+e,!1})),t.each(c,(function(t,e){if(e.match(/duplicate-fieldset-maxRows-/))return l=e.substring("duplicate-fieldset-maxRows-".length),!1}));var s=function(){(o=t(d)).each((function(e,n){var i=t(this);i.removeClass("last"),i.removeClass("first"),0==e&&i.addClass("first"),e==o.length-1&&i.addClass("last"),f(i),i.hasClass("duplicate")?i.find(".duplication-buttons button.duplication-button--remove").show():i.find(".duplication-buttons button.duplication-button--remove").hide()}))},r=function(e){e.find(".duplication-buttons button.duplication-button--add").off("click").on("click",(function(e){return e.preventDefault(),function(e){if(null!=l&&o.length>=l)return void t(document).trigger("fieldset-clone-rejected",[e,o,l]);var i=e.clone();u++;const a={};i.find("input[name], select[name], textarea[name]").each((function(){var i=t(this);i.removeClass("error");var o=i.attr("id");if(void 0!==o){(c=o.indexOf("_duplicate_"))>=0&&(o=o.substr(0,c));var d=o+"_duplicate_"+u;i.closest(n.widgetSelector).find('label[for="'+i.attr("id")+'"]').each((function(){var e=t(this);e.attr("for",d),void 0!==e.attr("id")&&e.attr("id",e.attr("id")+"_duplicate_"+u)})),i.attr("id",d)}var l=i.attr("name");if(void 0!==l){var c;(c=l.indexOf("_duplicate_"))>=0&&(l=l.substr(0,c));var s=l+"_duplicate_"+u;i.attr("name",s),a[l]=s}var r=i.attr("value");"checkbox"!==i.attr("type")&&"radio"!==i.attr("type")?i.val()&&void 0!==r&&!1!==r&&(i.val()!==r||e.hasClass("duplicate-fieldset-donotcopy"))&&i.val(""):i.not("[checked]").prop("checked",!1)})),i.find("fieldset[data-cff-condition]").each(((t,e)=>{let n=e.dataset.cffCondition;for(const[t,e]of Object.entries(a))n=n.replaceAll(t,e);e.dataset.cffCondition=n})),i.find("label").removeClass("error"),i.find("p.error").remove(),i.find(n.widgetSelector).removeClass("error"),i.addClass("duplicate"),r(i),e.after(i),s(),null!=l&&o.length>=l&&o.each((function(e,n){var i=t(this);i.find(".duplication-button--add").addClass("disabled"),i.find(".duplication-button--add").attr("disabled","disabled")})),t(document).trigger("fieldset-cloned",[i])}(t(this).closest("fieldset")),!1})),e.hasClass("duplicate")&&e.find(".duplication-buttons button.duplication-button--remove").off("click").on("click",(function(e){return e.preventDefault(),function(t){o.length>1&&t.hasClass("duplicate")&&(t.remove(),s())}(t(this).closest("fieldset")),!1}))},f=function(e){e.find(".duplication-buttons").remove();var i=t('<div class="duplication-buttons"></div>'),a=t('<button type="button" class="duplication-button duplication-button--add">'+n.buttonAdd+"</button>");i.append(a);var o=t('<button type="button" class="duplication-button duplication-button--remove">'+n.buttonRemove+"</button>");i.append(o),n.prepend?e.prepend(i):e.append(i),r(e)};s()})),this}}(jQuery);