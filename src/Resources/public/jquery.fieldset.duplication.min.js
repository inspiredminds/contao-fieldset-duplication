!function(t){"use strict";t.fn.fieldsetDuplication=function(e){var i=t.extend({},{prepend:!1,buttonAdd:"+",buttonRemove:"&times;"},e);return t(this).each(function(e,n){var a=t(this),d=null,o=null,l=null,u=0,s=a.attr("class").split(/\s+/);t.each(s,function(t,e){if(e.match(/duplicate-fieldset-/))return o="."+e,!1}),t.each(s,function(t,e){if(e.match(/duplicate-fieldset-maxRows-/))return l=e.substring("duplicate-fieldset-maxRows-".length),!1});var r=function(){(d=t(o)).each(function(e,i){var n=t(this);n.removeClass("last"),n.removeClass("first"),0==e&&n.addClass("first"),e==d.length-1&&n.addClass("last"),f(n),n.hasClass("duplicate")?n.find(".duplication-buttons button.duplication-button--remove").show():n.find(".duplication-buttons button.duplication-button--remove").hide()})},c=function(e){e.find(".duplication-buttons button.duplication-button--add").off("click").on("click",function(e){return e.preventDefault(),function(e){if(d.length>=l)t(document).trigger("fieldset-clone-rejected",[e,fieldsets,l]);else{var i=e.clone();u++,i.find("input[name], select[name], textarea[name]").each(function(){var e=t(this);e.removeClass("error");var i=e.attr("id");if(void 0!==i){(d=i.indexOf("_duplicate_"))>=0&&(i=i.substr(0,d));var n=i+"_duplicate_"+u;e.closest(".widget").find('label[for="'+e.attr("id")+'"]').each(function(){var e=t(this);e.attr("for",n),void 0!==e.attr("id")&&e.attr("id",e.attr("id")+"_duplicate_"+u)}),e.attr("id",n)}var a=e.attr("name");if(void 0!==a){var d;(d=a.indexOf("_duplicate_"))>=0&&(a=a.substr(0,d));var o=a+"_duplicate_"+u;e.attr("name",o)}var l=e.attr("value");e.val()&&void 0!==l&&!1!==l&&e.val()!==l&&e.val(""),e.not("[checked]").prop("checked",!1)}),i.find("label").removeClass("error"),i.find("p.error").remove(),i.find(".widget").removeClass("error"),i.addClass("duplicate"),c(i),e.after(i),r(),d.length>=l&&d.each(function(e,i){var n=t(this);n.find(".duplication-button--add").addClass("disabled"),n.find(".duplication-button--add").attr("disabled","disabled")}),t(document).trigger("fieldset-cloned",[i])}}(t(this).closest("fieldset")),!1}),e.hasClass("duplicate")&&e.find(".duplication-buttons button.duplication-button--remove").off("click").on("click",function(e){var i;return e.preventDefault(),i=t(this).closest("fieldset"),d.length>1&&i.hasClass("duplicate")&&(i.remove(),r()),!1})},f=function(e){e.find(".duplication-buttons").remove();var n=t('<div class="duplication-buttons"></div>'),a=t('<button type="button" class="duplication-button duplication-button--add">'+i.buttonAdd+"</button>");n.append(a);var d=t('<button type="button" class="duplication-button duplication-button--remove">'+i.buttonRemove+"</button>");n.append(d),i.prepend?e.prepend(n):e.append(n),c(e)};r()}),this}}(jQuery);